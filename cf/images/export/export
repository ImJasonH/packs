#!/bin/bash

set -eo pipefail

if [[ $# -ne 1 ]]; then
  >&2 echo "Invalid arguments."
  exit 1
fi

if [[ $PACK_REGISTRY_GCR = true ]] || [[ $PACK_REGISTRY_GCR = 1 ]]; then
  echo "Configuring credentials for GCR."
  docker-credential-gcr configure-docker >/dev/null 2>&1
fi

mkdir -p home/vcap
tar xzf droplet.tgz -C home/vcap
chown -R vcap:vcap home

tar czf layer.tgz home
d8s append "${SRC_IMAGE}" "${1}" layer.tgz
